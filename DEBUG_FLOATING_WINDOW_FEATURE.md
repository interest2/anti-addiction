# 调试悬浮窗功能

## 功能概述

新增了一个调试悬浮窗功能，用于在页面底部实时展示APP定义的变量值，方便排查问题。

## 功能特点

### 1. 位置和尺寸
- **位置**: 页面底部
- **高度**: 屏幕高度的1/3
- **宽度**: 全屏宽度
- **背景**: 半透明黑色 (#80000000)
- **层级**: 置顶显示，不会被其他悬浮窗遮挡

### 2. 显示内容
调试悬浮窗会实时显示以下信息：

#### 基础信息
- ⏰ 当前时间 (HH:mm:ss格式)
- 📡 无障碍事件类型 (显示最后接收到的事件类型)
- ⏱️ 事件触发时间 (显示最后接收到事件的时间)
- 📱 当前活跃APP信息
  - APP名称
  - 包名
  - 目标词
  - APP状态 (target/other/未知)
  - 手动隐藏状态
  - 隐藏时间戳

#### 悬浮窗状态
- 🪟 主悬浮窗显示状态
- 🔧 调试悬浮窗显示状态

#### 设置信息
- ⏰ 时间间隔设置
- 🎯 宽松模式状态
- 📈 宽松模式使用次数

#### 系统信息
- 💾 内存使用情况
  - 已用内存
  - 可用内存
  - 总内存
  - 最大内存

### 3. 控制功能
- **刷新按钮**: 手动刷新调试信息
- **隐藏按钮**: 隐藏调试悬浮窗

### 4. 自动更新
- 每2秒自动更新一次调试信息
- 实时反映APP状态变化

## 使用方法

### 1. 开启调试悬浮窗
1. 打开应用
2. 进入"设置"页面
3. 找到"调试功能"区域
4. 点击"显示/隐藏调试悬浮窗"按钮
5. 调试悬浮窗将出现在屏幕底部

### 2. 关闭调试悬浮窗
- 方法1: 在设置页面再次点击"显示/隐藏调试悬浮窗"按钮
- 方法2: 在调试悬浮窗中点击"隐藏"按钮

### 3. 刷新调试信息
- 点击调试悬浮窗中的"刷新"按钮可手动刷新信息

## 技术实现

### 1. 核心类
- `DebugFloatingWindowManager`: 调试悬浮窗管理器
- `debug_floating_window_layout.xml`: 调试悬浮窗布局

### 2. 集成点
- `FloatService`: 在无障碍服务中初始化调试悬浮窗管理器
- `SettingsNav`: 在设置页面添加调试悬浮窗控制按钮
- `MainActivity`: 支持调试悬浮窗的生命周期管理

### 3. 权限要求
- `SYSTEM_ALERT_WINDOW`: 悬浮窗权限
- `BIND_ACCESSIBILITY_SERVICE`: 无障碍服务权限

## 调试信息说明

### APP状态
- `target`: 检测到目标界面
- `other`: 其他界面
- `未知`: 未检测到状态

### 手动隐藏状态
- `是`: APP被手动隐藏，在时间间隔内不会显示悬浮窗
- `否`: APP未被手动隐藏，可以正常显示悬浮窗

### 宽松模式
- `是`: 当前使用宽松模式，关闭悬浮窗后使用次数+1
- `否`: 当前使用严格模式

## 注意事项

1. **权限要求**: 需要悬浮窗权限才能显示调试悬浮窗
2. **性能影响**: 每2秒更新一次，对性能影响很小
3. **内存使用**: 调试悬浮窗会占用少量内存
4. **生命周期**: 调试悬浮窗会跟随主悬浮窗服务一起管理

## 故障排除

### 调试悬浮窗不显示
1. 检查是否有悬浮窗权限
2. 检查无障碍服务是否已启动
3. 重启应用后重试

### 调试信息不更新
1. 检查是否有活跃的APP
2. 检查无障碍服务是否正常工作
3. 点击刷新按钮手动更新

### 调试悬浮窗位置异常
1. 检查屏幕分辨率设置
2. 重启应用后重试

## 开发说明

### 添加新的调试信息
在 `DebugFloatingWindowManager.updateDebugContent()` 方法中添加新的调试信息：

```java
// 添加新的调试信息
debugInfo.append("🔧 新功能: ").append(newValue).append("\n");
```

### 修改更新频率
修改 `UPDATE_INTERVAL` 常量来调整更新频率：

```java
private static final long UPDATE_INTERVAL = 1000; // 1秒更新一次
```

### 自定义调试悬浮窗样式
修改 `debug_floating_window_layout.xml` 文件来自定义样式。 