# 新增功能：自定义APP管理

## 功能概述

本次更新为应用添加了自定义APP管理功能，允许用户动态添加新的APP到防沉迷列表中，无需修改代码即可支持更多应用。

## 新增功能

### 1. 主界面加号按钮
- 在主界面"支持的APP"标题右侧添加了加号按钮
- 点击后弹出添加APP的对话框

### 2. 添加APP弹窗
弹窗包含以下4个输入字段：
- **APP名称**：显示在卡片上的名称
- **包名**：应用的包名（如：com.example.app）
- **屏蔽关键词**：用于检测特定页面的关键词
- **宽松模式次数**：默认值为1，可自定义

### 3. 数据存储
- 自定义APP数据保存在SharedPreferences中
- 使用Gson进行JSON序列化
- 数据持久化，重启应用后仍然保留

### 4. 卡片显示
- 自定义APP会显示在主界面的卡片列表中
- 与预定义APP具有相同的功能：
  - 显示剩余时间
  - 显示宽松模式剩余次数
  - 点击可设置时间间隔

### 5. 防沉迷功能
- 自定义APP完全支持原有的防沉迷功能
- 包括悬浮窗显示、数学题验证、时间间隔设置等
- 支持严格模式和宽松模式

## 技术实现

### 核心类

1. **CustomAppManager**：管理自定义APP的增删改查
2. **Const.CustomApp**：自定义APP的数据模型
3. **SettingsManager**：扩展支持自定义APP的设置管理
4. **FloatingAccessibilityService**：扩展支持自定义APP的检测

### 数据流程

1. 用户点击加号按钮
2. 显示添加APP弹窗
3. 用户填写APP信息
4. 验证包名是否重复
5. 保存到CustomAppManager
6. 更新主界面卡片列表
7. 重启无障碍服务以应用新设置

## 使用方法

### 添加新APP
1. 打开应用主界面
2. 点击"支持的APP"右侧的加号按钮
3. 填写APP信息：
   - APP名称：如"微博"
   - 包名：如"com.sina.weibo"
   - 屏蔽关键词：如"热门,推荐"
   - 宽松模式次数：如"1"
4. 点击"保存"按钮

### 管理自定义APP
- 自定义APP会显示在卡片列表中
- 点击卡片可设置时间间隔
- 支持严格模式和宽松模式
- 数据自动保存，无需额外操作

## 注意事项

1. **包名唯一性**：包名不能与预定义APP重复
2. **关键词设置**：屏蔽关键词用于检测特定页面，建议使用APP中常见的页面标识
3. **权限要求**：添加自定义APP需要无障碍服务权限
4. **数据备份**：自定义APP数据保存在本地，卸载应用会丢失

## 兼容性

- 完全兼容现有的预定义APP
- 不影响原有功能
- 支持Android 6.0及以上版本
- 需要无障碍服务和悬浮窗权限

## 未来扩展

- 支持删除自定义APP
- 支持编辑自定义APP信息
- 支持导入/导出自定义APP配置
- 支持云端同步自定义APP列表 