# 算术题修改难度功能

## 功能描述

在"个性设置"菜单页面新增了"算术题修改难度"功能，允许用户自定义算术题的难度级别。该功能位于"目标设置"的后面，作为第二个设置项。

## 功能特性

### 界面元素
1. **小标题**："2、算术题修改难度"
2. **设置按钮**："设置算术题难度"
3. **单选对话框**：包含"默认难度"和"自定义难度"两个选项
4. **自定义设置弹窗**：标题为"数字位数设置"，包含3行输入框

### 自定义难度弹窗设计
- **加法设置**：显示"加法："标签，后面跟着输入框，输入框后面显示"位"字，默认值为`DEFAULT_ADD_DIGITS`
- **减法设置**：显示"减法："标签，后面跟着输入框，输入框后面显示"位"字，默认值为`DEFAULT_SUBTRACT_DIGITS`
- **乘法设置**：显示"乘法："标签，后面跟着两个输入框（乘数位数×被乘数位数），每个输入框后面都显示"位"字，默认值分别为`DEFAULT_MULTIPLIER_FIRST_DIGITS`和`DEFAULT_MULTIPLIER_SECOND_DIGITS`

### 选项说明
- **默认难度**：使用系统预设的算术题难度
- **自定义难度**：允许用户分别设置加法、减法、乘法的数字位数（1-5位）

### 交互流程
1. 用户点击"设置算术题难度"按钮
2. 弹出单选对话框，默认选中"默认难度"
3. 如果选择"自定义难度"，弹出"数字位数设置"弹窗
4. 在弹窗中分别设置加法、减法、乘法的数字位数
5. 点击保存按钮，设置生效
6. 选中状态停留在"自定义难度"

## 技术实现

### 新增文件
- `ARITHMETIC_DIFFICULTY_FEATURE.md`：功能说明文档
- `dialog_math_difficulty_custom.xml`：自定义难度设置弹窗布局

### 修改文件

#### fragment_goal.xml
- 添加了"2、算术题修改难度"标题
- 添加了"设置算术题难度"按钮
- 位于"1、目标设置"区域后面

#### GoalNav.java
- 添加了算术题难度设置按钮的点击事件处理
- 在`onCreateView`中初始化按钮并设置点击事件

#### SettingsDialogManager.java
- 添加了`showMathDifficultyDialog`方法：显示难度选择对话框
- 修改了`showCustomMathDifficultyDialog`方法：使用新的布局文件，支持3行输入框
- 复用了`SettingsManager`中的`KEY_MATH_`相关变量和方法

### 数据存储
- 使用`SettingsManager`中的现有方法存储设置
- 难度模式：`KEY_MATH_DIFFICULTY_MODE`
- 加法位数：`KEY_MATH_ADDITION_DIGITS`
- 减法位数：`KEY_MATH_SUBTRACTION_DIGITS`
- 乘法乘数位数：`KEY_MATH_MULTIPLICATION_MULTIPLIER_DIGITS`
- 乘法被乘数位数：`KEY_MATH_MULTIPLICATION_MULTIPLICAND_DIGITS`

### 验证机制
- **输入验证**：每个输入框只允许输入1-5之间的数字
- **长度限制**：每个输入框最多输入1位数字
- **空值检查**：不允许任何输入框为空
- **数字格式验证**：确保所有输入为有效数字
- **分别验证**：加法、减法、乘法的位数分别验证

## 用户体验

### 界面设计
- **清晰布局**：使用与其他设置项一致的样式
- **直观操作**：单选对话框和3行输入框设计符合用户习惯
- **即时反馈**：所有操作都有Toast提示
- **合理位置**：位于"目标设置"后面，符合用户预期
- **详细标签**：每个输入框都有明确的标签说明

### 错误处理
- **加法位数为空**：提示"请输入加法位数"
- **减法位数为空**：提示"请输入减法位数"
- **乘数位数为空**：提示"请输入乘数位数"
- **被乘数位数为空**：提示"请输入被乘数位数"
- **超出范围**：提示"XX位数请输入1-5之间的数字"
- **无效数字**：提示"请输入有效的数字"

### 状态保持
- **选中状态**：选择"自定义难度"后，状态会保持在该选项
- **设置持久化**：所有设置都保存到SharedPreferences
- **重启生效**：应用重启后设置仍然有效
- **默认值显示**：弹窗显示当前保存的设置值

## 与现有功能的集成

### MathChallengeManager集成
- 自动读取用户设置的难度模式
- 根据模式选择使用默认或自定义的数字位数
- 实时应用新的难度设置
- 支持分别使用加法、减法、乘法的自定义位数

### 设置管理器集成
- 完全复用现有的`SettingsManager`类
- 使用已有的`KEY_MATH_`相关变量和方法
- 保持数据存储的一致性
- 支持所有算术题类型的独立设置

### 页面布局集成
- 与"目标设置"保持一致的视觉风格
- 使用相同的按钮样式和间距
- 编号为"2"，与"1、目标设置"形成序列

## 功能验证

### 测试场景
1. **默认难度设置**：选择默认难度，验证使用预设参数
2. **自定义难度设置**：分别设置加法、减法、乘法的位数，验证使用自定义参数
3. **输入验证**：测试各种无效输入的处理
4. **状态保持**：验证设置保存和重启后的状态
5. **页面导航**：验证从"个性设置"页面可以正常访问
6. **分别设置**：验证加法、减法、乘法可以设置不同的位数

### 预期结果
- 用户可以通过"个性设置"页面轻松设置算术题难度
- 可以分别设置加法、减法、乘法的数字位数
- 设置立即生效并持久保存
- 算术题生成时使用正确的难度参数
- 所有错误输入都得到适当的提示
- 功能位置符合用户预期，位于目标设置后面 