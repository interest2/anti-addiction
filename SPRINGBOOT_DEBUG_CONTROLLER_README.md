# SpringBoot 调试信息接收器

## 功能概述

提供了三个不同复杂度的SpringBoot控制器来接收Android端上报的调试信息，并格式化打印到控制台和日志文件。

## 控制器选择

### 1. UltraSimpleDebugController (推荐)
- **特点**: 最简单，直接接收JSON字符串并格式化打印
- **优点**: 无需定义任何实体类，代码最少
- **适用**: 快速调试，只需要查看JSON数据

### 2. SimpleDebugInfoController
- **特点**: 使用Map接收JSON数据，结构化打印
- **优点**: 代码简洁，无需定义实体类
- **适用**: 需要结构化显示调试信息

### 3. DebugInfoController
- **特点**: 使用JsonNode解析，详细分类打印
- **优点**: 信息分类清晰，便于分析
- **适用**: 需要详细分析调试信息

## 使用方法

### 1. 启动服务
```bash
# 使用Maven启动
mvn spring-boot:run

# 或者打包后运行
mvn clean package
java -jar target/debug-info-receiver-1.0.0.jar
```

### 2. 接口地址
- **调试信息上报**: `POST http://localhost:5001/antiAddict/runLog`
- **健康检查**: `GET http://localhost:5001/antiAddict/health`

### 3. 请求格式
```json
{
  "timestamp": 1703123456789,
  "reportTime": "2023-12-21 10:30:56.789",
  "lastEventType": 32,
  "currentInterface": "target",
  "forceCheck": false,
  "currentApp": {
    "appName": "微信",
    "packageName": "com.tencent.mm",
    "className": "com.tencent.mm.ui.LauncherUI",
    "appState": "target"
  },
  "isFloatingWindowVisible": true
}
```

## 日志输出示例

### UltraSimpleDebugController 输出
```
==================================================================================
📱 调试信息接收时间: 2023-12-21 10:30:56.789
==================================================================================
📋 完整JSON数据:
{
  "timestamp" : 1703123456789,
  "reportTime" : "2023-12-21 10:30:56.789",
  "lastEventType" : 32,
  "currentInterface" : "target",
  "forceCheck" : false,
  "currentApp" : {
    "appName" : "微信",
    "packageName" : "com.tencent.mm",
    "className" : "com.tencent.mm.ui.LauncherUI",
    "appState" : "target"
  },
  "isFloatingWindowVisible" : true
}
==================================================================================
📊 调试信息打印完成
==================================================================================
```

### SimpleDebugInfoController 输出
```
==================================================================================
📱 调试信息接收时间: 2023-12-21 10:30:56.789
==================================================================================
⏰ 上报时间戳: 1703123456789
📅 上报时间: 2023-12-21 10:30:56.789
--------------------------------------------------
📡 事件信息:
   事件类型: 32
   事件时间: 2023-12-21 10:30:56.000
   文本检测时间: 2023-12-21 10:30:56.500
--------------------------------------------------
🔧 调试时间戳:
   h0: 2023-12-21 10:30:56.000 (1703123456000)
   h1: 2023-12-21 10:30:56.100 (1703123456100)
   h7: 2023-12-21 10:30:56.500 (1703123456500)
   h8: 2023-12-21 10:30:56.600 (1703123456600)
--------------------------------------------------
🖥️ 界面状态:
   当前界面: target
   强制检查: false
--------------------------------------------------
📱 当前APP信息:
   APP名称: 微信
   包名: com.tencent.mm
   类名: com.tencent.mm.ui.LauncherUI
   APP状态: target
   隐藏时间: 无
   手动隐藏: false
--------------------------------------------------
🪟 悬浮窗状态: 显示
--------------------------------------------------
📱 设备信息:
   品牌: Xiaomi
   型号: Mi 10
   Android版本: 11
   应用版本: 1.0.0
==================================================================================
📊 调试信息打印完成
==================================================================================
```

## 配置文件说明

### application.yml
- **端口**: 5001 (与Android端配置一致)
- **日志级别**: INFO
- **日志文件**: logs/debug-info.log
- **日志轮转**: 10MB/文件，保留30天

## 部署建议

### 开发环境
使用 `UltraSimpleDebugController`，快速查看JSON数据。

### 生产环境
使用 `SimpleDebugInfoController` 或 `DebugInfoController`，便于日志分析和监控。

## 注意事项

1. **端口配置**: 确保5001端口未被占用
2. **日志目录**: 确保logs目录有写入权限
3. **内存使用**: 长时间运行建议监控内存使用情况
4. **网络安全**: 生产环境建议配置防火墙和HTTPS

## 故障排除

### 1. 端口被占用
```bash
# 查看端口占用
netstat -an | grep 5001

# 修改配置文件中的端口
server:
  port: 5002
```

### 2. 日志文件权限
```bash
# 创建日志目录
mkdir -p logs
chmod 755 logs
```

### 3. 内存不足
```bash
# 增加JVM内存
java -Xmx512m -jar target/debug-info-receiver-1.0.0.jar
``` 